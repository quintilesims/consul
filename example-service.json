{
  "AWSEBDockerrunVersion": 2,
  "containerDefinitions": [
    {
      "entrypoint": [ "/bin/sh", "-c" ],
      "command": [ "/bin/registrator -retry-attempts=-1 -retry-interval=10000 -ip $(wget http://169.254.169.254/latest/meta-data/local-ipv4 -q -O -) consul://consul-agent:8500" ],
      "dnsSearchDomains": [
        "service.consul",
        "node.consul"
      ],
      "dnsServers": [
        "172.17.0.1",
        "10.100.0.2"
      ],
      "essential": true,
      "image": "gliderlabs/registrator:latest",
      "links": [
        "consul-agent"
      ],
      "memory": 128,
      "mountPoints": [
        {
          "containerPath": "/tmp/docker.sock",
          "sourceVolume": "dockersocket"
        }
      ],
      "name": "registrator"
    },
    {
      "entrypoint": [ "/bin/sh", "-c" ],
      "command": [ "export JIP=$(wget -qO- 169.254.169.254/latest/meta-data/local-ipv4);export JNODE=$(wget -qO- 169.254.169.254/latest/meta-data/local-hostname); consul agent -client 0.0.0.0 -recursor 10.100.0.2 -advertise $JIP -node $JNODE -retry-join $EXTERNAL_URL" ],
      "dnsSearchDomains": [
        "service.consul",
        "node.consul"
      ],
      "dnsServers": [
        "172.17.0.1",
        "10.100.0.2"
      ],
      "environment": [
        {
          "name": "EXTERNAL_URL",
          "value": "replace with Consul's private loadbalancer URL"
        },
        {
          "name": "CONSUL_ALLOW_PRIVILEGED_PORTS",
          "value": ""
        },
        {
          "name": "CONSUL_LOCAL_CONFIG",
          "value": "{\"leave_on_terminate\":true}"
        },
        {
          "name": "UPSTREAM_DNS",
          "value": "10.100.0.2"
        }
      ],
      "essential": true,
      "image": "consul:latest",
      "memory": 128,
      "name": "consul-agent",
      "portMappings": [
        {
          "containerPort": 8500,
          "hostPort": 8500
        },
        {
          "containerPort": 8300,
          "hostPort": 8300
        },
        {
          "containerPort": 8300,
          "hostPort": 8300,
          "protocol": "udp"
        },
        {
          "containerPort": 8301,
          "hostPort": 8301
        },
        {
          "containerPort": 8301,
          "hostPort": 8301,
          "protocol": "udp"
        },
        {
          "containerPort": 8302,
          "hostPort": 8302
        },
        {
          "containerPort": 8302,
          "hostPort": 8302,
          "protocol": "udp"
        },
        {
          "bindIP": "172.17.0.1",
          "containerPort": 8600,
          "hostPort": 53,
          "protocol": "udp"
        }
      ]
    },
    {
      "dnsSearchDomains": [
        "service.consul",
        "node.consul"
      ],
      "dnsServers": [
        "172.17.0.1",
        "10.100.0.2"
      ],
      "environment": [
        {
          "name": "EXAMPLE_SERVICE_PARAM",
          "value": "<%SLAVE_SERVICE_NAME%>"
        },
        {
          "name": "EXAMPLE_SERVICE_PARAM_2",
          "value": "--accept-license --answer-yes --no-prompt"
        }
      ],
      "essential": true,
      "hostname": "A Layer0 Service",
      "image": "",
      "memory": 10000,
      "name": "cluster-slave",
      "portMappings": [
        {
          "containerPort": 8089,
          "hostPort": 8089
        },
        {
          "containerPort": 8000,
          "hostPort": 9000
        },
        {
          "containerPort": 8088,
          "hostPort": 8088
        },
        {
          "containerPort": 9997,
          "hostPort": 9997
        },
        {
          "containerPort": 9888,
          "hostPort": 9888
        }
      ],
      "privileged": true
    }
  ],
  "volumes": [
    {
      "host": {
        "sourcePath": "/var/run/docker.sock"
      },
      "name": "dockersocket"
    }
  ]
}
