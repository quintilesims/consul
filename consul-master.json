{
  "AWSEBDockerrunVersion": 2,
  "containerDefinitions": [
    {
      "entrypoint": [ "/bin/sh", "-c" ],
      "command": [ "consul agent -data-dir=/consul/data -client 0.0.0.0 -server -bootstrap-expect=3 -ui -recursor $UPSTREAM_DNS -advertise $(curl -s http://169.254.169.254/latest/meta-data/local-ipv4) -node $(curl -s http://169.254.169.254/latest/meta-data/local-hostname) -retry-join $EXTERNAL_URL" ],
      "environment": [
        {
          "name": "CONSUL_ALLOW_PRIVILEGED_PORTS",
          "value": ""
        },
        {
          "name": "CONSUL_LOCAL_CONFIG",
          "value": "{\"skip_leave_on_interrupt\":true}"
        },
        {
          "name": "EXTERNAL_URL",
          "value": "internal-l0-bivers0926-consull43eb1-1421006476.us-west-2.elb.amazonaws.com"
        },
        {
          "name": "UPSTREAM_DNS",
          "value": "10.100.0.2"
        }
      ],
      "essential": true,
      "image": "consul:latest",
      "memory": 1024,
      "name": "consul-server",
      "networkMode": "host",
      "portMappings": [
        {
          "containerPort": 8500,
          "hostPort": 8500
        },
        {
          "containerPort": 8300,
          "hostPort": 8300
        },
        {
          "containerPort": 8300,
          "hostPort": 8300,
          "protocol": "udp"
        },
        {
          "containerPort": 8301,
          "hostPort": 8301
        },
        {
          "containerPort": 8301,
          "hostPort": 8301,
          "protocol": "udp"
        },
        {
          "containerPort": 8302,
          "hostPort": 8302
        },
        {
          "containerPort": 8302,
          "hostPort": 8302,
          "protocol": "udp"
        },
        {
          "bindIP": "172.17.0.1",
          "containerPort": 8600,
          "hostPort": 53,
          "protocol": "udp"
        }
      ]
    }
  ],
  "family": "consul-server",
  "volumes": [
    {
      "host": {
        "sourcePath": "/consul/data"
      },
      "name": "consuldata"
    }
  ]
}
